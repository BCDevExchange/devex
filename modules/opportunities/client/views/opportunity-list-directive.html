<!-- Buttons that should sit just above the Open Opportunities -->
<div class="container" ng-if="vm.isUser">
  <div style="padding: .75em 0;">  
    <button ng-if="vm.userCanAdd" class="btn btn-primary pull-right" ng-class="{'btn-default': !vm.project && !vm.program, 'btn-link': vm.project || vm.program}" ui-sref="opportunityadmin.createlanding({programId:vm.programId, projectId:vm.projectId, programTitle:vm.programTitle, projectTitle:vm.projectTitle, context:vm.context})" title="New"><i class="fa fa-plus"></i> Post an Opportunity</button>
    <button class="btn btn-primary pull-right" ng-if="!vm.user.notifyOpportunities" ng-click="vm.subscribe(opportunity);$event.preventDefault(); $event.stopPropagation()" uib-tooltip="Get emails about new opportunities">Subscribe &nbsp;<i class="fa fa-bell"></i></button>
    <button class="btn btn-secondary pull-right" ng-if="vm.user.notifyOpportunities" ng-click="vm.unsubscribe(opportunity);$event.preventDefault(); $event.stopPropagation()" uib-tooltip="You'll get emails about new opportunities">Subscribed &nbsp;<i class="fa fa-bell"></i></button>
  </div>
</div>

<!-- Open Opportunities Container -->
<section>
  <div class="container">
    <div class="opportunity-list-header">
      Open Opportunities
    </div>
    <div class="alert" ng-if="vm.isLoading">
      <i class="fa fa-lg fa-spinner fa-spin"></i>&nbsp; Loading Opportunities
    </div>
    <div ng-if="!vm.isLoading">
      <div class="alert" ng-if="vm.countOpenOpportunities() === 0">
        <i class="fa fa-lg fa-frown-o"></i>&nbsp; No open opportunities right now - check back soon, or make sure you're signed up for notifications <a href="/settings/privacy">in your profile</a>
      </div>
      <div class="opportunity-list">  
        <div class="card" ng-class="{'card-greyed': !opportunity.isPublished}"
          ng-repeat="opportunity in vm.opportunities | orderBy:'created':true | filter:vm.filterOpen">

          <!--{{opportunity.isWatching=vm.isWatching(opportunity);""}}-->

          <div class="card-header text-right" ng-if="vm.isAdmin || opportunity.userIs.admin">
            <label class="label label-default" ng-if="!opportunity.isPublished"><i class="fa fa-exclamation-triangle" ></i> Unpublished</label>
            <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.isPublished" href="javascript:void(0);" ng-click="vm.publish(opportunity, false); $event.stopPropagation()" title="Unpublish"><i class="fa fa-ban"></i></a>
            <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && !opportunity.isPublished" href="javascript:void(0);" ng-click="vm.publish(opportunity, true); $event.stopPropagation()" title="Publish"><i class="fa fa-bullhorn"></i></a>
            <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.opportunityTypeCd==='code-with-us'" href="javascript:void(0);"  id="opportunityadmin.edit" ui-sref="opportunityadmin.editcwu({ opportunityId: opportunity.code, projectId: vm.projectId })" ng-click="$event.stopPropagation()" title="Edit"><i class="fa fa-gear"></i></a>
            <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.opportunityTypeCd==='sprint-with-us'" href="javascript:void(0);"  id="opportunityadmin.edit" ui-sref="opportunityadmin.editswu({ opportunityId: opportunity.code, projectId: vm.projectId })" ng-click="$event.stopPropagation()" title="Edit"><i class="fa fa-gear"></i></a>
          </div>

          <!-- Open SWU opportunity card body layout -->
          <div class="card-body" ng-if="opportunity.opportunityTypeCd==='sprint-with-us'" id="opportunities.view" ui-sref="opportunities.viewswu({ opportunityId: opportunity.code, projectId: vm.projectId })">
            <div class="label-list">
              <label class="label label-price" ng-if="opportunity.opportunityTypeCd==='sprint-with-us'">{{opportunity.budget|currency}}</label>
              <label class="label label-opp-type"><i class="fa fa-users"></i> Sprint With Us</label>
              <label class="label label-watching pull-right" ng-if="vm.isUser">
                  <button class="button-watching" ng-if="!opportunity.isWatching" ng-click="vm.addWatch(opportunity);$event.preventDefault(); $event.stopPropagation()"><i class="fa fa-eye fa-lg gray-light"></i></button>
                  <button class="button-watching" ng-if="opportunity.isWatching" ng-click="vm.removeWatch(opportunity);$event.preventDefault(); $event.stopPropagation()"><i class="fa fa-eye fa-lg text-primary"></i></button>
              </label>

              <label class="label label-location"><i class="fa fa-map-marker fa-lg"></i>&nbsp;{{opportunity.location}}
                  &middot;
                  <span class="gray-light" ng-if="opportunity.onsite == 'offsite'">In-person work NOT required</span>
                  <span class="gray-light" ng-if="opportunity.onsite == 'onsite'">In-person work required</span>
                  <span class="gray-light" ng-if="opportunity.onsite == 'mixed'">Some in-person work required</span>
              </label>
            </div>
            <div class="card-title opportunity-card-title" ng-bind="opportunity.name"></div>
            <!-- I'd like to experiment for a while with NOT having the teaser on the cards -->
            <!-- <div class="card-teaser" ng-bind="opportunity.short"></div> -->
          </div>

          <!-- Open CWU opportunity card body layout -->
          <div class="card-body" ng-if="opportunity.opportunityTypeCd==='code-with-us'" id="opportunities.view" ui-sref="opportunities.viewcwu({ opportunityId: opportunity.code, projectId: vm.projectId })">
            <div class="label-list">
              <label class="label label-price">{{opportunity.earn|currency}}</label>
              <label class="label label-opp-type"><i class="fa fa-code"></i> Code With Us</label>
              <label class="label label-location"><i class="fa fa-map-marker fa-lg"></i>&nbsp;{{opportunity.location}}
                  &middot;
                  <span class="gray-light" ng-if="opportunity.onsite == 'offsite'">In-person work NOT required</span>
                  <span class="gray-light" ng-if="opportunity.onsite == 'onsite'">In-person work required</span>
                  <span class="gray-light" ng-if="opportunity.onsite == 'mixed'">Some in-person work required</span>
              </label>
            </div>
            <div class="label-list">
              <label class="label label-skill" ng-repeat="code in opportunity.skills">{{code}}</label>
            </div>
            <div class="card-title opportunity-card-title" ng-bind="opportunity.name"></div>
            <!-- I'd like to experiment for a while NOT having the teaser on the cards -->
            <!-- <div class="card-teaser" ng-bind="opportunity.short"></div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Closed Opportunities Container -->
<section style="background: #E0F2FA;">
  <div class="container">
    <div class="opportunity-list-header">
      Closed Opportunities
      <span class="value-tally pull-right hidden-xs">Total value: {{vm.getTotalClosedAmount() | currency}}</span>
    </div>
    <div ng-if="!vm.isLoading">
      <div class="opportunity-list">
        <div class="card" 
            ng-repeat="opportunity in vm.opportunities | orderBy:'created':true | filter:vm.filterClosed"
            ng-init="$last && vm.finishedRenderingClosed()">

            <!-- May want to remove these options from Closed opportunities; don't want people changing opportunities whose deadlines have already passed -->          
            <div class="card-header text-right" ng-if="vm.isAdmin || opportunity.userIs.admin">
              <label class="label label-default" ng-if="!opportunity.isPublished"><i class="fa fa-exclamation-triangle" ></i> Unpublished</label>
              <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.isPublished" href="javascript:void(0);" ng-click="vm.publish(opportunity, false); $event.stopPropagation()" title="Unpublish"><i class="fa fa-ban"></i></a>
              <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && !opportunity.isPublished" href="javascript:void(0);" ng-click="vm.publish(opportunity, true); $event.stopPropagation()" title="Publish"><i class="fa fa-bullhorn"></i></a>
              <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.opportunityTypeCd==='code-with-us'" href="javascript:void(0);"  id="opportunityadmin.edit" ui-sref="opportunityadmin.editcwu({ opportunityId: opportunity.code, projectId: vm.projectId })" ng-click="$event.stopPropagation()" title="Edit"><i class="fa fa-gear"></i></a>
              <a class="btn btn-text-only" ng-if="(vm.isAdmin || opportunity.userIs.admin) && opportunity.opportunityTypeCd==='sprint-with-us'" href="javascript:void(0);"  id="opportunityadmin.edit" ui-sref="opportunityadmin.editswu({ opportunityId: opportunity.code, projectId: vm.projectId })" ng-click="$event.stopPropagation()" title="Edit"><i class="fa fa-gear"></i></a>
            </div>

            <!-- CLOSED SWU opportunity card body layout -->
            <div class="card-body" ng-if="opportunity.opportunityTypeCd==='sprint-with-us'" id="opportunities.view" ui-sref="opportunities.viewswu({ opportunityId: opportunity.code, projectId: vm.projectId })">
                <div class="label-list">
                    <label class="label label-price" ng-if="opportunity.opportunityTypeCd==='sprint-with-us'">{{opportunity.budget|currency}}</label>

                    <label class="label label-opp-type"><i class="fa fa-users"></i> Sprint With Us</label>
                    <label class="label label-location"><i class="fa fa-map-marker fa-lg"></i>&nbsp;{{opportunity.location}}
                        &middot;
                        <span class="gray-light" ng-if="opportunity.onsite == 'offsite'">In-person work NOT required</span>
                        <span class="gray-light" ng-if="opportunity.onsite == 'onsite'">In-person work required</span>
                        <span class="gray-light" ng-if="opportunity.onsite == 'mixed'">Some in-person work required</span>
                    </label>
                </div>
                <div class="card-title opportunity-card-title" ng-bind="opportunity.name"></div>
                <!-- <div class="card-teaser" ng-bind="opportunity.short"></div> -->
            </div>

            <!-- CLOSED CWU opportunity card body layout -->
            <div class="card-body" ng-if="opportunity.opportunityTypeCd==='code-with-us'" id="opportunities.view" ui-sref="opportunities.viewcwu({ opportunityId: opportunity.code, projectId: vm.projectId })">
                <div class="label-list">
                  <label class="label label-price">{{opportunity.earn|currency}}</label>
                  <label class="label label-opp-type"><i class="fa fa-code"></i> Code With Us</label>
                  <label class="label label-location"><i class="fa fa-map-marker fa-lg"></i>&nbsp;{{opportunity.location}}
                      &middot;
                      <span class="gray-light" ng-if="opportunity.onsite == 'offsite'">In-person work NOT required</span>
                      <span class="gray-light" ng-if="opportunity.onsite == 'onsite'">In-person work required</span>
                      <span class="gray-light" ng-if="opportunity.onsite == 'mixed'">Some in-person work required</span>
                  </label>
                </div>
                <div class="label-list">
                  <label class="label label-skill" ng-repeat="code in opportunity.skills">{{code}}</label>
                </div>
                <div class="card-title opportunity-card-title" ng-bind="opportunity.name"></div>
                <!-- <div class="card-teaser" ng-bind="opportunity.short"></div> -->
            </div>
        </div>
      </div>
    </div>
  </div>
</section>
