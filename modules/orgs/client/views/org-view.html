<section>
  <div class="container">

    <div class="row mb-3" ng-if="(vm.isOrgMember() || vm.isAdmin()) && vm.orgHasMetRFQ">
      <div class="col">
        <label class="mb-1 label label-swu-qualified" uib-tooltip="Your company is qualified to apply on Sprint With Us opportunities!">
          <i class="fas fa-certificate"></i> 
          <span class="font-italic">Sprint With Us</span> Qualified!
        </label>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-6 mt-2 mb-5">
        <div class="d-flex align-items-start justify-content-between">
          <div class="d-flex align-items-center">
            <edit-avatar org="vm.org">
              <img class="mr-3 rounded edit-image" uib-tooltip="Click to edit" height="60" width="60" ng-click="vm.edit()">
            </edit-avatar>
            <div>
              <h4>{{ vm.org.name }}</h4>
              <div class="text-truncate" ng-if="vm.org.website">{{vm.org.website}}</div>
              <div class="missing-info" data-automation-id="lnkAddWebsite" ng-if="!vm.org.website && (vm.isOrgAdmin() || vm.isAdmin())" ng-click="vm.editOrgInfo()">Add website</div>
            </div>
          </div>
          <a class="subhead ml-5" data-automation-id="btnEdit_left" ng-if="vm.isOrgAdmin() || vm.isAdmin()" ng-click="vm.editOrgInfo()">Edit</a>
        </div>
      </div>

      <!-- Company Info -->
      <div ng-if="vm.isOrgMember() || vm.isAdmin()" class="col-12 col-md-6">
        <div class="subhead mt-2 d-flex align-items-center justify-content-between">
          <h5>Company Info</h5>
          <a class="subhead" data-automation-id="btnEdit_right" ng-if="vm.isOrgAdmin() || vm.isAdmin()" ng-click="vm.editOrgContact()">Edit</a>
        </div>
        <!-- Address -->
        <div class="mb-3">
          <div class="text-muted font-weight-bold">Legal Address</div>
          <div ng-if="vm.org.address">{{vm.org.address}}</div>
          <div ng-if="!vm.org.address" class="missing-info" ng-click="vm.editOrgContact()">Add address</div>
          <div ng-if="vm.org.address2">{{vm.org.address2}}</div>
          <div>
            <span ng-if="vm.org.city">{{vm.org.city}}</span>
            <span ng-if="!vm.org.city" class="missing-info" ng-click="vm.editOrgContact()">Add city</span> 
            &nbsp;
            <span ng-if="vm.org.province">{{vm.org.province}}</span>
            <span ng-if="!vm.org.province" class="missing-info" ng-click="vm.editOrgContact()">XX</span>
          </div> 
          <div ng-if="vm.org.postalcode">{{vm.org.postalcode}}</div>
          <div ng-if="!vm.org.postalcode" class="missing-info" ng-click="vm.editOrgContact()">Add postal</div>
        </div>
        <!-- Business Registration -->
        <div class="mb-3">
          <div class="text-muted font-weight-bold">Business Registration</div>
          <div ng-if="vm.org.businessNumber" data-automation-id="lblBusinessRegistration">{{vm.org.businessNumber}}</div>
          <div ng-if="!vm.org.businessNumber" class="missing-info" ng-click="vm.editOrgContact()">Add</div>
        </div>
        <!-- Company Contact -->
        <div class="mb-3">
          <div class="text-muted font-weight-bold">Company Contact</div>
          <div ng-if="vm.org.contactName">{{vm.org.contactName}}</div>
          <div ng-if="!vm.org.contactName" class="missing-info" ng-click="vm.editOrgContact()">Add contact person</div>
          <div ng-if="vm.org.contactPhone">{{vm.org.contactPhone}}</div>
          <div ng-if="!vm.org.contactPhone" class="missing-info" ng-click="vm.editOrgContact()">Add phone</div>
          <div ng-if="vm.org.contactEmail">{{vm.org.contactEmail}}</div>
          <div ng-if="!vm.org.contactEmail" class="missing-info" ng-click="vm.editOrgContact()">Add email</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Members section; should only appear if user is logged in and is a company admin -->    
<section ng-if="vm.isOrgAdmin() || vm.isAdmin()">
  <div class="container">
    <div class="row d-flex justify-content-between">
      <!-- Member requests -->
      <div class="col-md-12 col-lg-5">
        <div class="subhead">
          <h5>Member Requests</h5>
        </div>
        <div ng-if="vm.org.joinRequests.length > 0">
          <p>These people have requested to join your company:</p>
          <ul class="list-group">
            <li ng-repeat="member in vm.org.joinRequests" 
                class="list-group-item d-flex w-100 align-items-center member"
                ng-click="vm.viewMemberDetails(member, true)">
  
              <avatar-display url="member.profileImageURL" size="40"></avatar-display>
              <name>{{member.displayName}}</name>
              <div class="float-right ml-auto">
                <button type="button" class="btn btn-text-only" data-automation-id="btnAcceptMember" ng-click="vm.acceptMember(member); $event.stopPropagation();" title="Add member">
                  <i class="far fa-2x fa-check-circle"></i>
                </button>
                <button type="button" class="btn btn-text-only" data-automation-id="btnDeclineMember" ng-click="vm.declineMember(member); $event.stopPropagation();" title="Decline request">
                  <i class="far fa-2x fa-times-circle"></i>
                </button>
              </div>
            </li>
          </ul>
        </div>
        <div ng-if="vm.org.joinRequests.length === 0">
          <p>No requests.</p>
        </div>
      </div>
      <!--END // Member requests -->

      <!-- Members list -->
      <div class="col-md-12 col-lg-6">
        <div class="subhead">
          <h5>Members</h5>
        </div>
        <!--If company only has one member-->
        <div ng-if="vm.org.members.length < 2" class="mb-3">
          <small><i class="fas fa-exclamation-triangle danger"></i> To qualify to apply on <span class="font-italic">Sprint With Us</span> opportunities, you must have at least two members in your company.</small>
        </div>
        <!-- Search field to filter the members list, if company has more than 12 members-->
        <div class="input-group" ng-if="vm.org.members.length > 12">
          <div class="input-group-prepend">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
          </div>
          <input class="form-control" 
                type="text" 
                ng-model="vm.searchTerm" 
                placeholder="Find a member...">
        </div>
        
        <div class="py-2">
          <div class="member" ng-repeat="member in vm.org.members | filter: { displayName: vm.searchTerm }" ng-click="vm.viewMemberDetails(member, false)">
            <avatar-display url="member.profileImageURL" size="25"></avatar-display>
            <name>{{member.displayName}}</name>
          </div>
        </div>
      </div><!-- END // Members list -->
    </div>
  </div><!--END // Container -->
</section><!--END // Section -->
      

<section>
  <div class="container">
    <!--Capabilities & Skills -->
    <div ng-if="vm.isOrgMember() || vm.isOrgAdmin() || vm.isAdmin()" class="row">
      <div class="col">
        <div class="subhead">
          <h5>Capabilities</h5>
        </div>
        <!--If all SWU capabilities aren't possessed-->
        <div ng-if="!vm.orgIsCapable" class="mb-3">
          <i class="fas fa-exclamation-triangle danger"></i> <small>To qualify to apply on <span class="font-italic">Sprint With Us</span> opportunities, you need members who collectively possess all of the following capabilities:</small>
        </div>
        <!--Capabilities list-->
        <div class="py-2">
          <label ng-repeat="capability in vm.capabilities" class="label-cap-default">
            <span ng-if="vm.orgHasCapability(capability)"><i class="fas fa-lg fa-check-circle"></i> {{capability.name}}</span>
            <span ng-if="!vm.orgHasCapability(capability)" class="unpublished"><i class="fas fa-lg fa-question-circle danger"></i> {{capability.name}}</span>
          </label>
        </div>     

        <!--Skills list-->
        <div class="subhead d-flex align-items-center">
          <h5>Preferred Technical Skills</h5>
          <!--Would like to add this later if we can add the logic to populate all of the existing skills that are not possessed by the company in addition to the ones that are-->
          <!--<button class="btn p-0 ml-2 mb-2" uib-popover="These skills are sometimes called for on Sprint With Us opportunities. The more of them your members possess, the higher you'll score." popover-trigger="outsideClick"><i class="far fa-question-circle"></i></button>-->
        </div>
        <div class="py-2">
          <label ng-repeat="capabilitySkill in vm.orgSkills" class="label-preferred-skill-possessed mr-3">{{capabilitySkill.name}}</label>
        </div>
      </div>
    </div>

    <!--SWU Terms-->
    <div ng-if="vm.isOrgAdmin() || vm.isAdmin()" class="row">
      <div class="col">
        <div class="subhead">
          <h5><span class="font-italic">Sprint With Us</span> Terms</h5>
        </div>
        <!--Display this div if company has not yet accepted the terms-->
        <div ng-if="!vm.org.isAcceptedTerms">
          <p><i class="fas fa-exclamation-triangle danger"></i> To apply on <span class="font-italic">Sprint With Us</span> opportunities, you must agree to <a href="/terms/rfq1" target="_blank">the terms of the Request for Qualifications</a>.</p>
          <div class="d-flex align-items-center">
            <button class="btn btn-primary mr-4" ng-click="vm.acceptTerms()">Accept</button>
            <div class="small text-muted">By clicking Accept, you are acknowledging that you have read, fully understand, and agree to all the terms, conditions and procedures.</div>
          </div>
        </div>
        <!-- Display this paragraph once the company has accepted the terms-->
        <!-- We only started tracking the date of term acceptance in Jan 2019.  So if the tracking date is not present, just show creation date for the org -->
        <p ng-if="vm.org.isAcceptedTerms && !vm.org.acceptedTermsDate">You accepted the <a href="/terms/rfq1" target="_blank">terms</a> on {{ vm.org.created | date : longDate }}</p>
        <p ng-if="vm.org.isAcceptedTerms && vm.org.acceptedTermsDate" class="text-muted">You accepted the <a href="/terms/rfq1" target="_blank">terms</a> on {{ vm.org.acceptedTermsDate | date : longDate }}</p>
      </div>
    </div>

    <div ng-if="vm.isOrgAdmin() || vm.isAdmin()" class="row">
      <div class="col py-5">
        <div class="subhead">
          <h5>Delete Company Profile</h5>
        </div>
        <p><small>Once you delete your company profile, there is no going back. Please be certain.</small></p>
        <button class="btn btn-text-only" data-automation-id="btnDelete" ng-click="vm.removeOrg()"><i class="far fa-trash-alt"></i> Delete company profile</button>
      </div>
    </div>
  </div><!--End container-->
</section>
